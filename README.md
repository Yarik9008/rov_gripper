# ROV Gripper Project

Проект для управления захватом ROV (Remotely Operated Vehicle).

## Описание

Этот проект предназначен для разработки системы управления захватом подводного робота. Проект использует PlatformIO для разработки на микроконтроллере STM8.

## Текущая функциональность

- **Мигание светодиодом** - базовая программа для тестирования работы микроконтроллера
- Светодиод подключен к пину PC13 (встроенный светодиод на BluePill)
- Интервал мигания: 500 мс включено / 500 мс выключено

## Технические характеристики

- **Микроконтроллер**: STM32F103C8T6 (72MHz, 20KB RAM, 64KB Flash)
- **Платформа**: STM32 BluePill F103C8
- **Фреймворк**: Arduino (STM32 Core)
- **Инструмент разработки**: PlatformIO
- **Программатор**: ST-Link V2

## Структура проекта

```
rov_gripper/
├── src/
│   └── main.c          # Основной код программы
├── include/            # Заголовочные файлы
├── lib/               # Библиотеки
├── test/              # Тесты
├── platformio.ini    # Конфигурация PlatformIO
└── README.md          # Этот файл
```

## Установка и запуск

1. Установите PlatformIO
2. Клонируйте репозиторий
3. Откройте проект в PlatformIO IDE
4. Подключите ST-Link V2 к микроконтроллеру STM32F103:
   ```
   STM32F103    ST-Link V2
   ----------   -----------
   VCC     →    3.3V
   GND     →    GND  
   SWDIO   →    SWDIO
   SWCLK   →    SWCLK
   NRST    →    NRST
   ```
5. Скомпилируйте и загрузите на микроконтроллер:
   ```bash
   pio run -e stm32f103 -t upload
   ```

## Команды PlatformIO

```bash
# Компиляция проекта
pio run -e stm32f103

# Прошивка микроконтроллера
pio run -e stm32f103 -t upload

# Очистка проекта
pio run -e stm32f103 -t clean

# Мониторинг последовательного порта
pio device monitor
```

## Подробная инструкция по подключению STM32 к ST-Link V2

### Схема подключения

```
STM32F103 BluePill    ST-Link V2
------------------    -----------
Pin 1  (3.3V)    →    3.3V
Pin 2  (GND)     →    GND
Pin 3  (PB3)     →    SWDIO
Pin 4  (PB4)     →    SWCLK  
Pin 5  (PB5)     →    NRST
```

### Альтернативная схема подключения

Если у вас ST-Link V2 с отдельными контактами:
```
STM32F103    ST-Link V2
---------    -----------
VCC     →    3.3V
GND     →    GND
PA13    →    SWDIO
PA14    →    SWCLK
NRST    →    NRST
```

### Пошаговая инструкция

1. **Отключите питание** микроконтроллера перед подключением
2. **Подключите провода** согласно схеме выше
3. **Проверьте подключение** - все контакты должны быть надежно соединены
4. **Подключите ST-Link** к компьютеру через USB
5. **Установите драйверы** ST-Link (если не установлены)
6. **Проверьте обнаружение** устройства:
   ```bash
   pio device list
   ```
7. **Скомпилируйте и загрузите**:
   ```bash
   pio run -e stm32f103 -t upload
   ```

### Решение проблем

**Проблема**: "Maple DFU" в диспетчере устройств
- Микроконтроллер в режиме загрузчика
- Отключите USB питание, используйте только ST-Link
- Выполните: `pio run -e stm32f103 -t upload`
- Или используйте STM32CubeProgrammer для принудительной загрузки

**Проблема**: "No ST-Link detected" / Некорректное определение
- **Установите драйверы ST-Link** с сайта ST
- **Проверьте физическое подключение** всех 5 проводов
- **Используйте качественный USB кабель**
- **Попробуйте другой USB порт**
- **Проверьте перемычки BOOT0=GND, BOOT1=GND**

**Проблема**: "Target not responding"
- Убедитесь, что STM32 получает питание 3.3V
- Проверьте подключение NRST
- Попробуйте подключение под сбросом

**Проблема**: "Connection failed"
- Проверьте подключение SWDIO и SWCLK
- Убедитесь, что нет коротких замыканий
- Попробуйте другой ST-Link

**Проблема**: ST-Link не обнаружен системой
- **Скачайте ST-Link Utility** с https://www.st.com/en/development-tools/stsw-link004.html
- **Или установите STM32CubeIDE** с драйверами
- **Проверьте в Диспетчере устройств** наличие "STMicroelectronics STM32 STLink"
- **Используйте STM32CubeProgrammer** как альтернативу

### Режим Maple DFU - подробное решение

Если STM32F103 отображается как "Maple DFU" в диспетчере устройств:

#### Причина:
- Микроконтроллер находится в режиме загрузчика (bootloader mode)
- Плата загружена с Maple bootloader
- Нужно переключить в нормальный режим работы

#### Решение 1: Через ST-Link (рекомендуется)
1. **Отключите USB** от STM32F103
2. **Подключите ST-Link** согласно схеме
3. **Питание только от ST-Link** (3.3V)
4. **Выполните команду**:
   ```bash
   pio run -e stm32f103 -t upload
   ```

#### Решение 2: STM32CubeProgrammer
1. **Скачайте** STM32CubeProgrammer с сайта ST
2. **Подключите ST-Link** к STM32F103
3. **Откройте программу** и выберите ST-Link
4. **Нажмите "Connect"**
5. **Загрузите файл** `.pio/build/stm32f103/firmware.bin`

#### Решение 3: Проверка перемычек
На плате BluePill проверьте:
- **BOOT0** должен быть подключен к **GND**
- **BOOT1** должен быть подключен к **GND**

#### Решение 4: Полная очистка
```bash
# Очистка и перекомпиляция
pio run -e stm32f103 -t clean
pio run -e stm32f103
pio run -e stm32f103 -t upload
```

### Альтернативные методы прошивки

Если ST-Link не работает:
- **STM32CubeProgrammer** - официальная утилита ST
- **OpenOCD** - открытый отладчик
- **Arduino IDE** с поддержкой STM32

## Лицензия

MIT License - см. файл LICENSE для подробностей.
